"use strict";angular.module("org.bonitasoft.bonitable",[]).controller("BonitableController",["$scope",function(e){this.getOptions=function(){return e.sortOptions},this.setOptions=function(t){e.sortOptions=t},this.onStorageLoaded=function(){return e.onStorageLoaded()},this.triggerSortHandler=function(t){e.onSort({options:t})};var t=[];this.registerSelector=function(e){t.push(e)},this.unregisterSelector=function(e){t.splice(t.indexOf(e),1)};var r={$selectedItems:function(){return t.filter(n).map(o)},$allSelected:function(){return this.$selectedItems.length===t.length},$indeterminate:function(){return this.$selectedItems.length!==t.length&&this.$selectedItems.length>0}};function n(e){return e.isChecked()}function o(e){return e.data}this.prepareScope=function(e){Object.keys(r).forEach(function(e){Object.defineProperty(this,e,{get:r[e],enumerable:!0,iterable:!0})},e),e.$toggleAll=function(){var e=!this.$allSelected;t.forEach(function(t){t.setChecked(e)})}}}]).directive("bonitable",function(){return{priority:100,scope:{onSort:"&",sortOptions:"=",repeatableConfig:"=",onStorageLoaded:"&"},transclude:"element",controller:"BonitableController",compile:function(){return function(e,t,r,n,o){o(function(e,r){n.prepareScope(r),t.after(e)})}}}}),angular.module("org.bonitasoft.dragAndDrop",[]).provider("boDraggableItem",function(){var e={cloneOnDrop:!0,bodyClass:!1};this.cloneOnDrop=function(t){e.cloneOnDrop=t},this.activeBodyClassName=function(t){e.bodyClass=t},this.$get=function(){return{config:function(){return angular.copy(e)},allowCloneOnDrop:function(){return this.config().cloneOnDrop||!1},setBodyClass:function(){return!!this.config().bodyClass}}}}).service("boDragUtils",function(){this.generateUniqId=function(e){return(e||"drag-")+Math.random().toString(36).substring(7)},this.polyfillIE=function(e){Array.prototype.forEach.call(e,function(e){angular.element(e).on("selectstart",function(){return this.dragDrop(),!1})})},this.getDragInitiatorNode=function(e){for(var t=e;t.parentNode;){if("true"===t.getAttribute("draggable"))return t;t=t.parentNode}return null}}).directive("boDropzone",["$document","$parse","$compile","boDragUtils","boDragEvent","boDraggableItem",function(e,t,r,n,o,a){var i={},l=o.events.DROPZONE_CLASSNAME_HOVER,s=o.events.DRAGITEM_OWN_DROPZONE,c=o.events.CLASSNAME_DRAG_HOVER;return e.on("dragenter",function(e){if(e.target.hasAttribute("data-drop-id")){var t=!!angular.element("#"+o.currentDragItemId).find("[draggable] [data-drop-id="+e.target.getAttribute("data-drop-id")+"]")[0],r=!!angular.element("#"+o.currentDragItemId).find("[data-drop-id="+e.target.getAttribute("data-drop-id")+"]")[0];angular.element(document.querySelectorAll("."+s)).removeClass(s),(t||r)&&(e.target.className+=" "+s),angular.element(document.querySelectorAll("."+l)).removeClass(l),e.target.className+=" "+l}}),e.on("dragover",function(e){if(e.preventDefault(),e.target.hasAttribute("data-drop-id")){var t=e.target.getAttribute("data-drop-id");return i[t].onDragOver(i[t].scope,{$event:e}),(e.dataTransfer||e.originalEvent.dataTransfer).dropEffect="copy",!1}}),e.on("drop",function(e){if(e.preventDefault(),a.setBodyClass()&&angular.element(document.body).removeClass("bo-drag-action"),e.target.hasAttribute("data-drop-id")){var t=e.target.getAttribute("data-drop-id"),s=JSON.parse((e.dataTransfer||e.originalEvent.dataTransfer).getData("Text")),u=document.getElementById(s.dragItemId),d=i[t].scope,g=o.map[s.dragItemId],p=g.data;if(s.isDropZoneChild)e.target.appendChild(u);else{var f=u.cloneNode(!0);f.id=n.generateUniqId(),o.copy(s.dragItemId,f.id);try{f.attributes.removeNamedItem("ng-repeat")}catch(e){}a.allowCloneOnDrop()&&e.target.appendChild(f),r(angular.element(f))(o.map[f.id].scope)}d.$apply(function(){angular.element(document.getElementsByClassName(l)).removeClass(l),angular.element(document.getElementsByClassName(c)).removeClass(c),g.onDropItem(d,{$data:p,$event:e}),i[t].onDropSuccess(d,{$data:p,$event:e})})}}),{type:"A",link:function(e,r,o){r.addClass("bo-dropzone-container"),o.$set("data-drop-id",n.generateUniqId("drop")),i[o["data-drop-id"]]={scope:e,onDropSuccess:t(o.boDropSuccess),onDragOver:t(o.boDragOver)}}}}]).factory("boDragEvent",function(){var e={};return{map:e,events:{DROPZONE_CLASSNAME_HOVER:"bo-dropzone-hover",DRAGITEM_OWN_DROPZONE:"bo-drag-dropzone-child",CLASSNAME_DRAG_HOVER:"bo-drag-enter"},copy:function(t,r){e[r]=e[t]}}}).directive("boDraggable",["$document","$parse","boDragEvent","boDragUtils","boDraggableItem",function(e,t,r,n,o){return e.on("dragstart",function(e){var t=n.getDragInitiatorNode(e.target),a=e.dataTransfer||e.originalEvent.dataTransfer;o.setBodyClass()&&angular.element(document.body).addClass("bo-drag-action"),a.effectAllowed="copy",a.setData("Text",JSON.stringify({dragItemId:t.id,isDropZoneChild:t.parentElement.hasAttribute("data-drop-id")})),r.currentDragItemId=t.id,r.map[t.id]&&r.map[t.id].onDragStart(r.map[t.id].scope)}),e.on("dragenter",function(e){e.target.className.indexOf(r.events.CLASSNAME_DRAG_HOVER)>-1||(angular.element(document.getElementsByClassName(r.events.CLASSNAME_DRAG_HOVER)).removeClass(r.events.CLASSNAME_DRAG_HOVER),e.target.className+=" "+r.events.CLASSNAME_DRAG_HOVER)}),e.on("dragleave",function(e){e.target.className.indexOf(r.events.CLASSNAME_DRAG_HOVER)>-1&&(e.target.className=e.target.className.replace(" "+r.events.CLASSNAME_DRAG_HOVER,""))}),{link:function(e,o,a){a.$set("draggable",!0),a.$set("id",a.id||n.generateUniqId()),r.map[a.id]={key:a.boDraggableData,scope:e,onDragStart:t(a.boDragStart),onDropItem:t(a.boDropItem)},e.$evalAsync(function(e){r.map[a.id].data=e[a.boDraggableData]})}}}]).directive("boDragPolyfill",["$window","$document","$timeout","boDragUtils",function(e,t,r,n){return e.navigator.userAgent.indexOf("MSIE 9")>-1&&t.on("drop",function(e){e.preventDefault(),r(function(){n.polyfillIE(document.querySelectorAll("[bo-draggable], [data-bo-draggable]"))},100)}),{type:"EA",link:function(){e.navigator.userAgent.indexOf("MSIE 9")>-1&&r(function(){n.polyfillIE(document.querySelectorAll("[bo-draggable], [data-bo-draggable]"))},100)}}}]),angular.module("org.bonitasoft.services.topurl",[]).service("manageTopUrl",["$window",function(e){var t={getCurrentPageToken:function(){var t=/(^|[&\?])_p=([^&]*)(&|$)/.exec(e.parent.location.hash);return Array.isArray(t)?t[2]:""},addOrReplaceParam:function(r,n){if(void 0!==n&&e.self!==e.parent){var o=t.getCurrentPageToken();if(e.parent.location.hash){var a=new RegExp("(^|[&\\?])"+o+r+"=[^&]*(&|$)"),i=e.parent.location.hash.match(a);if(Array.isArray(i)){var l="";n&&(l=o+r+"="+n),e.parent.location.hash=e.parent.location.hash.replace(a,"$1"+l+"$2")}else{var s=e.parent.location.hash;n&&(e.parent.location.hash+=(s.indexOf("&",s.length-2)>=0?"":"&")+o+r+"="+n)}return}n&&(e.parent.location.hash="#"+o+r+"="+n)}},getCurrentProfile:function(){if(e&&e.parent&&e.parent.location&&e.parent.location.hash){var t=e.parent.location.hash.match(/\b_pf=\d+\b/);return Array.isArray(t)?t[0]:""}},getPath:function(){return e.parent.location.pathname},getSearch:function(){return e.parent.location.search||""},getUrlToTokenAndId:function(e,r){return t.getPath()+t.getSearch()+"#?id="+(e||"")+"&_p="+(r||"")+"&"+t.getCurrentProfile()},goTo:function(r){var n="&";if(angular.isUndefined(r))throw new TypeError("You must pass an Object as argument");if("string"!=typeof r){var o=!angular.isDefined(r.prependToken)||!!r.prependToken;if(!r.token)throw new Error("You must set a token to define the destination page");angular.forEach(r,function(e,t){t&&e&&"token"!==t&&"prependToken"!==t&&(n+=(o?r.token:"")+t+"="+e+"&")}),e.parent.location.hash!==e.location.hash&&(e.parent.location.hash="?_p="+r.token+"&"+t.getCurrentProfile()+n)}else e.parent.location.hash="?_p="+r+"&"+t.getCurrentProfile()}};return t}]),angular.module("org.bonitasoft.bonitable.repeatable",["org.bonitasoft.bonitable"]).directive("columnTemplate",["$compile","$timeout",function(e,t){return{restrict:"A",scope:!0,link:function(r,n,o){n.html(o.columnTemplate.replace("th","div").replace("td","div"));var a=n.contents();e(a)(r),t(function(){[].slice.call(a[0].attributes).forEach(function(e){n.attr(e.name,e.value)}),n.append(a.contents()),a.remove()},0)}}}]).directive("boRepeatable",["$interpolate",function(e){return{require:"bonitable",restrict:"A",compile:function(t,r,n){var o=r[this.name]||"thead tr:last-child",a=t[0].querySelector(o),i=t[0].querySelector("tr[ng-repeat]");if(!a||!i||a.children.length!==i.children.length)throw new Error("bo-repeatable th number does not correspond to td number. please verify you html table");var l,s=[],c=i.children;[].some.call(a.children,function(e,t){return l=t,null===e.getAttribute("data-ignore")});var u=r.visibleProp||"visible";function d(e,t){var r=document.createElement(e);return r.setAttribute("column-template",t),r.setAttribute("ng-repeat","column in $columns | filter:$visibilityFilter"),r}s=[].map.call(a.children,function(e,t){return{th:e,td:c[t]}}).filter(function(e){return null===e.th.getAttribute("data-ignore")}).map(function(t){angular.element(t.th).remove(),angular.element(t.td).remove();var r={name:e(t.th.textContent)(n),header:t.th.outerHTML,cell:t.td.outerHTML};return r[u]=angular.isUndefined(t.th.getAttribute)||angular.isUndefined(t.th.getAttribute(u))||"false"!==t.th.getAttribute(u),r.toRemoveExpression=t.th.getAttribute("remove-column"),r});var g=d("th","{{::column.header}}"),p=d("td","{{::column.cell}}");return a.insertBefore(g,a.children[l]),i.insertBefore(p,i.children[l]),function(t){t.$columns=s.filter(function(r){return!(r.toRemoveExpression&&"true"===e(r.toRemoveExpression)(t))}),t.$visibilityFilter=function(e,t){return!0===t[e]}.bind(null,u)}}}}]).directive("repeatableConfig",function(){return{priority:2,require:"bonitable",link:function(e,t,r){e.$watch(r.repeatableConfig,function(t){var n=r.visibleProp||"visible";if(t.length!==e.$columns.length)throw new Error("repeatable-config size differ from $columns size. Please check your config attr");e.$columns.forEach(function(e,r){e[n]=t[r]})})}}}),angular.module("org.bonitasoft.bonitable.storable",["org.bonitasoft.bonitable","ngStorage"]).directive("boStorable",["$localStorage",function(e){return{restrict:"A",require:"^bonitable",priority:1,link:function(t,r,n,o){var a=n.boStorable;if(!a)throw new Error("you must set a storageId to bo-storable");t.clearTableStorage=function(t){delete e[t]},e[a]||(e[a]={}),e[a].columns?t.$columns=e[a].columns:e[a].columns=null,e[a].sortOptions?(o.getOptions().property=e[a].sortOptions.property,o.getOptions().direction=e[a].sortOptions.direction):e[a].sortOptions=null,e[a].itemsPerPage?t.pagination.itemsPerPage=e[a].itemsPerPage:e[a].itemsPerPage=null,t.$watch(o.getOptions,function(t){e[a].sortOptions=t},!0),t.$watch("$columns",function(t,r){t!==r&&(e[a].columns=t)},!0),t.$watch("pagination.itemsPerPage",function(t){e[a].itemsPerPage=t},!0),o.onStorageLoaded()}}}]),angular.module("org.bonitasoft.bonitable.selectable",["org.bonitasoft.bonitable"]).directive("boSelectall",function(){return{restrict:"A",require:"^bonitable",replace:!0,template:'<input type="checkbox" ng-checked="$allSelected" ng-click="$toggleAll()">',link:function(e,t){e.$watch(function(){return e.$indeterminate},function(e){t[0].indeterminate=e})}}}).directive("boSelector",function(){return{restrict:"A",require:"^bonitable",link:function(e,t,r,n){var o=t.controller("ngModel"),a={data:e.$eval(r.boSelector),isChecked:function(){return o&&!0===o.$modelValue||t[0].checked},setChecked:function(e){o?(o.$setViewValue(!0===e),o.$render()):t[0].checked=e}};t.on("change",function(){e.$apply()}),e.$on("$destroy",function(){n.unregisterSelector(a)}),n.registerSelector(a)}}}),angular.module("org.bonitasoft.bonitable.settings",["ui.bootstrap.dropdown","ui.bootstrap.buttons"]).directive("tableSettings",function(){return{templateUrl:"template/table-settings/tableSettings.tpl.html",replace:!0,scope:{columns:"=",sizes:"=",pageSize:"=",labelProp:"@",visibleProp:"@",updatePageSize:"&",updateVisibility:"&"},link:function(e,t,r){e.visible=r.visibleProp||"visible",e.label=r.labelProp||"name",e.isDragging=!1,e.sortableOptions={}}}}),angular.module("org.bonitasoft.bonitable.sortable",["org.bonitasoft.bonitable"]).directive("boSorter",function(){function e(e){return e?"DESC":"ASC"}function t(e,t){return e["boSorterTitle"+t.charAt()+t.substring(1).toLowerCase()]||"Sort by "+t}return{restrict:"A",require:"^bonitable",scope:!0,templateUrl:"template/sortable/sorter.tpl.html",transclude:!0,link:function(r,n,o,a){if(r.property=(o.boSorter||o.id||"").trim(),0===r.property.length)throw new Error("bo-sorter: no id found. Please specify on which property the sort is applied to or add an id");r.sortOptions=a.getOptions();var i=e(r.sortOptions.direction);r.titleSortAttr=t(o,i),r.sort=function(){r.sortOptions.property===r.property?r.sortOptions.direction=!r.sortOptions.direction:(r.sortOptions.property=r.property,r.sortOptions.direction=!1),i=e(r.sortOptions.direction),r.titleSortAttr=t(o,i),a.triggerSortHandler(r.sortOptions)}}}});